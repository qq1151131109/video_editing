# Video Editing Custom Nodes

## 视频裁切节点 (VideoCropNode)

这个节点可以批量裁切视频文件。

### 功能特点
- 支持多种视频格式：mp4, avi, mov, mkv, wmv, flv, webm
- 可配置裁切区域坐标
- 可选择是否保留音效
- 批量处理文件夹中的所有视频

### 输入参数
- **input_folder**: 输入文件夹选择（下拉框，可选择ComfyUI输入目录下的子文件夹）
- **output_folder_name**: 输出文件夹名字（自定义保存文件夹的名称）
- **crop_x1**: 裁切区域左上角X坐标
- **crop_y1**: 裁切区域左上角Y坐标  
- **crop_x2**: 裁切区域右下角X坐标
- **crop_y2**: 裁切区域右下角Y坐标
- **keep_audio**: 是否保留音效（可选，默认True）

### 使用方法
1. 将视频文件放入ComfyUI的默认输入文件夹或其子文件夹中
2. 从下拉框中选择要处理的文件夹（"input"表示根目录，其他选项为子文件夹）
3. 输入输出文件夹的名字（默认为"cropped_videos"）
4. 设置裁切坐标（左上角和右下角）
5. 选择是否保留音效
6. 运行节点，裁切后的视频将自动保存到ComfyUI的输出文件夹下的指定子文件夹

## 视频合并节点 (VideoMergeNode)

这个节点可以将素材视频和游戏视频按照指定位置关系合并。

### 功能特点
- 支持多种视频格式：mp4, avi, mov, mkv, wmv, flv, webm
- 自动处理不同尺寸的视频（取最宽为标准，等比缩放）
- 支持上下位置合并（素材在上/下）
- 智能时间轴处理（按游戏视频时长拼接素材）
- 使用游戏视频的音效
- 批量处理多个游戏视频

### 核心逻辑
1. **尺寸处理**: 取素材和游戏视频中最宽的宽度作为标准，较窄的视频等比缩放到相同宽度
2. **位置合并**: 根据选择的位置关系（up/down）进行垂直合并
3. **时间轴处理**: 以游戏视频的时长为标准，按顺序使用素材视频拼接，不足则取下一个素材，超出则截取
4. **音效处理**: 使用游戏视频的音效，忽略素材音效
5. **批量输出**: 每个游戏视频生成一个合并后的视频

### 输入参数
- **material_folder**: 素材视频文件夹选择（下拉框）
- **game_folder**: 游戏视频文件夹选择（下拉框）
- **position**: 位置关系（"up"表示素材在游戏视频上面，"down"表示素材在游戏视频下面）
- **audio_mode**: 音频模式（"game_only"只使用游戏音频，"mix"素材和游戏音频混音）
- **material_audio_volume**: 素材音频音量占比（0.0-2.0，默认0.5）
- **game_audio_volume**: 游戏音频音量占比（0.0-2.0，默认0.5）
- **output_folder_name**: 输出文件夹名字（默认"merged_videos"）
- **material_path**: 直接输入素材文件夹的完整路径（可选，优先级高于下拉框选择）
- **game_path**: 直接输入游戏文件夹的完整路径（可选，优先级高于下拉框选择）

### 使用方法

#### 方法1：使用下拉框选择（推荐新手）
1. 将素材视频放入ComfyUI输入目录的指定文件夹
2. 将游戏视频放入ComfyUI输入目录的指定文件夹
3. 选择素材和游戏视频的文件夹
4. 选择位置关系（up/down）
5. 选择音频模式（game_only/mix）
6. 如果选择mix模式，调整素材和游戏音频音量占比
7. 输入输出文件夹名称
8. 运行节点，系统会自动处理所有游戏视频

#### 方法2：直接输入路径（推荐高级用户）
1. 在 `material_path` 中输入素材文件夹的完整路径
2. 在 `game_path` 中输入游戏文件夹的完整路径
3. 选择位置关系（up/down）
4. 选择音频模式（game_only/mix）
5. 如果选择mix模式，调整素材和游戏音频音量占比
6. 输入输出文件夹名称
7. 运行节点，系统会自动处理所有游戏视频

**注意**: 直接输入的路径优先级高于下拉框选择，如果同时设置了直接路径和下拉框选择，将使用直接输入的路径。

### 音频模式说明
- **game_only**: 只使用游戏视频的音频，忽略素材视频的音频（默认模式）
- **mix**: 将素材视频和游戏视频的音频进行混音，两个音频会同时播放

### 音量控制说明
当选择 `mix` 模式时，可以分别调整素材和游戏音频的音量占比：
- **material_audio_volume**: 素材音频音量占比（0.0-2.0）
  - 0.0: 静音
  - 0.5: 50%音量（默认）
  - 1.0: 100%音量
  - 2.0: 200%音量（放大）
- **game_audio_volume**: 游戏音频音量占比（0.0-2.0）
  - 0.0: 静音
  - 0.5: 50%音量（默认）
  - 1.0: 100%音量
  - 2.0: 200%音量（放大）

**示例配置**：
- 素材音频0.3，游戏音频0.7：素材声音较小，游戏声音较大
- 素材音频1.0，游戏音频0.2：素材声音正常，游戏声音较小
- 素材音频0.0，游戏音频1.0：只播放游戏音频（等同于game_only模式）

### 处理流程
1. 扫描游戏视频文件夹，获取所有游戏视频
2. 扫描素材视频文件夹，获取所有素材视频
3. 对每个游戏视频：
   - 按顺序收集足够的素材视频（总时长≥游戏视频时长）
   - 将素材视频拼接成一个临时视频
   - 截取临时视频到游戏视频的时长
   - 将素材视频和游戏视频按指定位置合并
   - 使用游戏视频的音效
   - 保存合并后的视频

### 输出
返回处理结果信息，包括：
- 成功处理的游戏视频数量
- 输出文件夹路径
- 所有生成的合并视频文件路径列表

### 路径说明
- **输入路径**: 可选择ComfyUI的默认输入文件夹或其子文件夹
  - 选择"input"：使用 `ComfyUI/input/`
  - 选择子文件夹：使用 `ComfyUI/input/子文件夹名/`
- **输出路径**: 自动使用ComfyUI的默认输出文件夹下的自定义子文件夹（`ComfyUI/output/自定义文件夹名/`）

### 依赖安装
```bash
pip install -r requirements.txt
```

### 注意事项
- 素材视频用完后会停止处理剩余的游戏视频
- 每个素材视频只会被使用一次
- 合并后的视频文件名格式为：`{游戏视频名}_merged.mp4`
- 处理过程中会创建临时文件，处理完成后自动清理
